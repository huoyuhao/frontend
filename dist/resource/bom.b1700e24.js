var a=Object.defineProperty,e=Object.defineProperties,t=Object.getOwnPropertyDescriptors,l=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,d=(e,t,l)=>t in e?a(e,t,{enumerable:!0,configurable:!0,writable:!0,value:l}):e[t]=l;import{d as i,aB as n,P as s,q as u,B as m,f as c,a2 as p,r as f,o as b,c as v,w,k as y,g as I,E as M,J as h,at as x,h as k,I as g}from"./vendor.7b399e54.js";import{p as O}from"./index.cdf0aeb6.js";import{b as _,a as U}from"./config.30bfbe25.js";import{a as j,d as C}from"./index.57446d29.js";import{_ as L}from"./index.0cf77487.js";const D=i({name:"DAddMaterialBom",components:{MinusCircleOutlined:n,PlusOutlined:s},props:{visible:{required:!0,type:Boolean,default:!1},formData:{type:Object,default:()=>null},isModify:{required:!0,type:Boolean,default:!1}},setup(a,{emit:e}){const t=u({}),l=u({});_.forEach((a=>{const{title:e,dataIndex:r}=a;a.required&&(l[r]=[{required:!0,message:`${e}不能为空！`}]),t[r]="","rawMaterialList"===r&&(t[r]=[])}));const{useForm:r}=p,{resetFields:o,validate:d,validateInfos:i}=r(t,l),{visibleModal:n,close:s,submit:f}=j(m(a),e,{resetFields:o,validate:d},{formItem:t,api:"/bom"}),b=c([]),v=c({});O({api:"/material",method:"get"}).then((a=>{b.value=[],v.value={},a.forEach((a=>{var e;b.value.push({value:a.materialId,label:a.materialName}),v.value[a.materialId]=(null==(e=null==a?void 0:a.materialUnit)?void 0:e.materialUnitName)||""}))})).catch();return{addRawMaterialList:()=>{t.rawMaterialList.push({rawMaterialId:null,rawMaterialNum:null})},removeRawMaterialList:a=>{const e=t.rawMaterialList.indexOf(a);-1!==e&&t.rawMaterialList.splice(e,1)},materialArr:b,materialObj:v,bom:_,formItem:t,visibleModal:n,validateInfos:i,close:s,submit:f}}}),K=g(" 新增物料 ");const A=i({name:"DMaterialBom",components:{DAdd:L(D,[["render",function(a,e,t,l,r,o){const d=f("a-select"),i=f("a-form-item"),n=f("a-input-number"),s=f("a-col"),u=f("MinusCircleOutlined"),m=f("a-row"),c=f("PlusOutlined"),p=f("a-button"),g=f("a-input"),O=f("a-form"),_=f("a-modal");return b(),v(_,{visible:a.visibleModal,"onUpdate:visible":e[0]||(e[0]=e=>a.visibleModal=e),title:a.isModify?"修改":"新增",width:"800px",cancelText:"取消",okText:"提交",onOk:a.submit,onCancel:a.close},{default:w((()=>[y(O,{"label-col":{span:6},"wrapper-col":{span:14}},{default:w((()=>[(b(!0),I(h,null,M(a.bom,(e=>(b(),I(h,null,["targetMaterialId"===e.dataIndex?(b(),v(i,x({key:0,key:e.dataIndex,label:e.title},a.validateInfos[e.dataIndex]),{default:w((()=>[y(d,{value:a.formItem[e.dataIndex],"onUpdate:value":t=>a.formItem[e.dataIndex]=t,placeholder:"请选择","show-search":"","option-filter-prop":"label",options:a.materialArr},null,8,["value","onUpdate:value","options"])])),_:2},1040,["label"])):"targetMaterialNum"===e.dataIndex?(b(),v(i,x({key:1,key:e.dataIndex,label:e.title},a.validateInfos[e.dataIndex]),{default:w((()=>[y(n,{value:a.formItem[e.dataIndex],"onUpdate:value":t=>a.formItem[e.dataIndex]=t,placeholder:`请输入${e.title}`},null,8,["value","onUpdate:value","placeholder"])])),_:2},1040,["label"])):"rawMaterialList"===e.dataIndex?(b(),I(h,{key:2},[(b(!0),I(h,null,M(a.formItem.rawMaterialList,((t,l)=>(b(),v(i,{key:t+e+l,label:e.title,name:["domains1",l,"value"]},{default:w((()=>[y(m,{align:"middle"},{default:w((()=>[y(s,{span:"8"},{default:w((()=>[y(d,{value:t.rawMaterialId,"onUpdate:value":a=>t.rawMaterialId=a,placeholder:"请选择","show-search":"","option-filter-prop":"label",options:a.materialArr},null,8,["value","onUpdate:value","options"])])),_:2},1024),y(s,{span:"11",offset:"2"},{default:w((()=>[y(n,{value:t.rawMaterialNum,"onUpdate:value":a=>t.rawMaterialNum=a,placeholder:"请输入原材料数量",formatter:e=>`${e}${a.materialObj[t.rawMaterialId]||""}`,parser:e=>e.replace(`${a.materialObj[t.rawMaterialId]||""}`,"")},null,8,["value","onUpdate:value","formatter","parser"])])),_:2},1024),y(s,{span:"1"},{default:w((()=>[a.formItem.rawMaterialList.length>1?(b(),v(u,{key:0,class:"dynamic-delete-button",disabled:1===a.formItem.rawMaterialList.length,onClick:e=>a.removeRawMaterialList(t)},null,8,["disabled","onClick"])):k("",!0)])),_:2},1024)])),_:2},1024)])),_:2},1032,["label","name"])))),128)),y(i,{key:e.dataIndex},{default:w((()=>[y(p,{type:"dashed",style:{width:"60%","margin-left":"190px"},onClick:a.addRawMaterialList},{default:w((()=>[y(c),K])),_:1},8,["onClick"])])),_:2},1024)],64)):e.hideForm?k("",!0):(b(),v(i,x({key:3,key:e.dataIndex,label:e.title},a.validateInfos[e.dataIndex]),{default:w((()=>[y(g,{value:a.formItem[e.dataIndex],"onUpdate:value":t=>a.formItem[e.dataIndex]=t,disabled:a.isModify&&(e.disabled||!1)},null,8,["value","onUpdate:value","disabled"])])),_:2},1040,["label"]))],64)))),256))])),_:1})])),_:1},8,["visible","title","onOk","onCancel"])}]])},setup(){const a=u({title:"BOM",loading:!1,data:[],rowKey:"",bomMaterial:U,showModal:!1,formData:{}}),i="/bom",n=[];_.forEach((e=>{const{dataIndex:t,rowKey:l,hideTable:r}=e;l&&(a.rowKey=t),r||n.push(e)})),n.push({title:"操作",dataIndex:"action",align:"center",width:"80px",slots:{customRender:"action"}});const s=()=>{a.loading=!0,O({api:i,method:"get"}).then((e=>{a.loading=!1,a.data=e})).catch()},c=()=>{s()},{deleteModal:p}=C();return s(),f=((a,e)=>{for(var t in e||(e={}))r.call(e,t)&&d(a,t,e[t]);if(l)for(var t of l(e))o.call(e,t)&&d(a,t,e[t]);return a})({},m(a)),e(f,t({columns:n,query:s,update:c,add:()=>{a.showModal=!0,a.formData={}},deleteData:e=>{const t=e[a.rowKey],l={method:"delete",api:i,data:{[a.rowKey]:t}};p(l,(()=>{c()}))}}));var f}}),B=g("刷新"),P=g("新增"),q=g("删除");var R=L(A,[["render",function(a,e,t,l,r,o){const d=f("a-button"),i=f("d-table"),n=f("d-card"),s=f("d-add");return b(),I(h,null,[y(n,{title:a.title},{default:w((()=>[y(i,{loading:a.loading,columns:a.columns,"data-source":a.data,rowKey:a.rowKey,isSearch:!0},{header:w((()=>[y(d,{type:"primary",onClick:a.query},{default:w((()=>[B])),_:1},8,["onClick"]),y(d,{type:"primary",onClick:a.add},{default:w((()=>[P])),_:1},8,["onClick"])])),expandedRowRender:w((({record:e})=>[y(i,{columns:a.bomMaterial,"data-source":e.rawMaterialList,rowKey:"rawMaterialId"},null,8,["columns","data-source"])])),action:w((({record:e})=>[y(d,{type:"primary",size:"small",onClick:t=>a.deleteData(e)},{default:w((()=>[q])),_:2},1032,["onClick"])])),_:1},8,["loading","columns","data-source","rowKey"])])),_:1},8,["title"]),y(s,{visible:a.showModal,"onUpdate:visible":e[0]||(e[0]=e=>a.showModal=e),"form-data":a.formData,"is-modify":Boolean(a.formData[a.rowKey]),materialArr:a.data&&a.data.materialArr,onUpdate:a.update},null,8,["visible","form-data","is-modify","materialArr","onUpdate"])],64)}]]);export{R as default};
