var a=Object.defineProperty,e=Object.defineProperties,t=Object.getOwnPropertyDescriptors,l=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,d=Object.prototype.propertyIsEnumerable,i=(e,t,l)=>t in e?a(e,t,{enumerable:!0,configurable:!0,writable:!0,value:l}):e[t]=l;import{d as r,q as n,B as s,f as m,x as p,a2 as u,r as c,o as f,c as b,w as y,k as v,g as I,E as h,J as x,as as w,h as k,M,j as U,t as g,I as D}from"./vendor.a502bbf1.js";import{p as j}from"./index.6829e04c.js";import{a as O,d as _}from"./index.81a36e1e.js";import{l as C}from"./config.30bfbe25.js";import{_ as T}from"./index.b01bbdb3.js";const K=r({name:"DAddMaterialData",components:{},props:{visible:{required:!0,type:Boolean,default:!1},formData:{type:Object,default:()=>null},isModify:{required:!0,type:Boolean,default:!1}},setup(a,{emit:e}){const t=n({}),l=n({});C.forEach((a=>{const{title:e,dataIndex:o}=a;a.required&&(l[o]=[{required:!0,message:`${e}不能为空！`}]),t[o]=""}));const{useForm:o}=u,{resetFields:d,validate:i,validateInfos:r}=o(t,l),{visibleModal:c,close:f,submit:b}=O(s(a),e,{resetFields:d,validate:i},{formItem:t,api:"/material"}),y=m([]),v=m([]),I=()=>{j({api:"/material/type",method:"get"}).then((a=>{y.value=a.map((a=>({value:a.materialTypeId,label:a.materialTypeName})))})).catch(),j({api:"/material/unit",method:"get"}).then((a=>{v.value=a.map((a=>({value:a.materialUnitId,label:a.materialUnitName})))})).catch()};return p((()=>a.visible),(a=>{a&&I()})),I(),{dataType:y,dataUnit:v,list:C,formItem:t,visibleModal:c,validateInfos:r,close:f,submit:b}}});const q=r({name:"DMaterialData",components:{DAdd:T(K,[["render",function(a,e,t,l,o,d){const i=c("a-select"),r=c("a-form-item"),n=c("a-input"),s=c("a-form"),m=c("a-modal");return f(),b(m,{visible:a.visibleModal,"onUpdate:visible":e[0]||(e[0]=e=>a.visibleModal=e),title:a.isModify?"修改":"新增",width:"800px",cancelText:"取消",okText:"提交",onOk:a.submit,onCancel:a.close},{default:y((()=>[v(s,{"label-col":{span:6},"wrapper-col":{span:14}},{default:y((()=>[(f(!0),I(x,null,h(a.list,(e=>(f(),I(x,null,["materialTypeId"===e.dataIndex?(f(),b(r,w({key:0,key:e.dataIndex,label:e.title},a.validateInfos[e.dataIndex]),{default:y((()=>[v(i,{value:a.formItem[e.dataIndex],"onUpdate:value":t=>a.formItem[e.dataIndex]=t,placeholder:"请选择","show-search":"","option-filter-prop":"label",options:a.dataType,disabled:a.isModify},null,8,["value","onUpdate:value","options","disabled"])])),_:2},1040,["label"])):"materialUnitId"===e.dataIndex?(f(),b(r,w({key:1,key:e.dataIndex,label:e.title},a.validateInfos[e.dataIndex]),{default:y((()=>[v(i,{value:a.formItem[e.dataIndex],"onUpdate:value":t=>a.formItem[e.dataIndex]=t,placeholder:"请选择","show-search":"","option-filter-prop":"label",options:a.dataUnit,disabled:a.isModify},null,8,["value","onUpdate:value","options","disabled"])])),_:2},1040,["label"])):e.hideForm?k("",!0):(f(),b(r,w({key:2,key:e.dataIndex,label:e.title},a.validateInfos[e.dataIndex]),{default:y((()=>[v(n,{value:a.formItem[e.dataIndex],"onUpdate:value":t=>a.formItem[e.dataIndex]=t,disabled:a.isModify&&(e.disabled||!1)},null,8,["value","onUpdate:value","disabled"])])),_:2},1040,["label"]))],64)))),256))])),_:1})])),_:1},8,["visible","title","onOk","onCancel"])}]])},setup(){const a=M(),r=n({title:"物料",loading:!1,data:[],rowKey:"",showModal:!1,formData:{}}),m="/material",p=[];C.forEach((a=>{const{dataIndex:e,rowKey:t,hideTable:l}=a;t&&(r.rowKey=e),l||p.push(a)})),p.push({title:"操作",dataIndex:"action",align:"center",width:"80px",slots:{customRender:"action"}});const u=()=>{r.loading=!0,j({api:m,method:"get"}).then((a=>{r.loading=!1,r.data=a})).catch()},c=()=>{u()},{deleteModal:f}=_();return u(),b=((a,e)=>{for(var t in e||(e={}))o.call(e,t)&&i(a,t,e[t]);if(l)for(var t of l(e))d.call(e,t)&&i(a,t,e[t]);return a})({},s(r)),e(b,t({columns:p,routeLink:e=>{const{materialId:t}=e;a.push({path:"/material/material/detail",query:{materialId:t}})},query:u,update:c,add:()=>{r.showModal=!0,r.formData={}},deleteData:a=>{const e=a[r.rowKey],t={method:"delete",api:m,data:{[r.rowKey]:e}};f(t,(()=>{c()}))},modify:a=>{r.showModal=!0,r.formData=a}}));var b}}),N=D("刷新"),P=D("新增"),B=["onClick"],E=D("删除");var F=T(q,[["render",function(a,e,t,l,o,d){const i=c("a-button"),r=c("d-table"),n=c("d-card"),s=c("d-add");return f(),I(x,null,[v(n,{title:a.title},{default:y((()=>[v(r,{loading:a.loading,columns:a.columns,"data-source":a.data,rowKey:a.rowKey,isSearch:!0},{header:y((()=>[v(i,{type:"primary",onClick:a.query},{default:y((()=>[N])),_:1},8,["onClick"]),v(i,{type:"primary",onClick:a.add},{default:y((()=>[P])),_:1},8,["onClick"])])),materialName:y((({record:e,text:t})=>[U("a",{onClick:t=>a.routeLink(e)},g(t),9,B)])),materialType:y((({text:a})=>[U("p",null,g(a&&a.materialTypeName),1)])),materialUnit:y((({text:a})=>[U("p",null,g(a&&a.materialUnitName),1)])),action:y((({record:e})=>[v(i,{type:"primary",size:"small",onClick:t=>a.deleteData(e)},{default:y((()=>[E])),_:2},1032,["onClick"])])),_:1},8,["loading","columns","data-source","rowKey"])])),_:1},8,["title"]),v(s,{visible:a.showModal,"onUpdate:visible":e[0]||(e[0]=e=>a.showModal=e),"form-data":a.formData,"is-modify":Boolean(a.formData[a.rowKey]),onUpdate:a.update},null,8,["visible","form-data","is-modify","onUpdate"])],64)}]]);export{F as default};
