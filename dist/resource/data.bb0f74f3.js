var a=Object.defineProperty,e=Object.defineProperties,t=Object.getOwnPropertyDescriptors,l=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,d=Object.prototype.propertyIsEnumerable,i=(e,t,l)=>t in e?a(e,t,{enumerable:!0,configurable:!0,writable:!0,value:l}):e[t]=l;import{d as o,aA as n,P as s,q as m,B as u,a2 as c,r as p,o as f,c as I,w as b,k as w,g as v,E as y,J as x,as as M,h,I as k}from"./vendor.a502bbf1.js";import{p as O}from"./index.6829e04c.js";import{a as g,d as j}from"./index.81a36e1e.js";import{_}from"./index.b01bbdb3.js";const U=[{title:"唯一标识",dataIndex:"standardProcessId",rowKey:!0,hideTable:!0,hideForm:!0},{title:"工序代码",dataIndex:"standardProcessCode",required:!0},{title:"工序名称",dataIndex:"standardProcessName",required:!0},{title:"助记码",dataIndex:"standardProcessMnemonic",required:!0},{title:"⽬标物料",dataIndex:"targetMaterialId",hideTable:!0},{title:"⽬标物料",dataIndex:"targetMaterialName",hideForm:!0},{title:"目标物料数量",dataIndex:"targetMaterialNum"},{title:"原材料",dataIndex:"rawMaterialList",hideTable:!0,slots:{customRender:"rawMaterialList"}},{title:"合格率",dataIndex:"pass",required:!0},{title:"备注",dataIndex:"description"}],C=[{title:"物料ID",dataIndex:"rawMaterialId",rowKey:!0},{title:"物料代码",dataIndex:"rawMaterialCode"},{title:"物料名称",dataIndex:"rawMaterialName"},{title:"物料数量",dataIndex:"rawMaterialNum"}],D=o({name:"DAddProcessData",components:{MinusCircleOutlined:n,PlusOutlined:s},props:{visible:{required:!0,type:Boolean,default:!1},formData:{type:Object,default:()=>null},isModify:{required:!0,type:Boolean,default:!1},materialArr:Array,materialObj:Object},setup(a,{emit:e}){const t=m({}),l=m({});U.forEach((a=>{const{title:e,dataIndex:r}=a;a.required&&(l[r]=[{required:!0,message:`${e}不能为空！`}]),t[r]=""}));const{useForm:r}=c,{resetFields:d,validate:i,validateInfos:o}=r(t,l),{visibleModal:n,close:s,submit:p}=g(u(a),e,{resetFields:d,validate:i},{formItem:t,api:"/standard/process"});return{addRawMaterialList:()=>{t.rawMaterialList.push({rawMaterialId:null,rawMaterialNum:null})},removeRawMaterialList:a=>{const e=t.rawMaterialList.indexOf(a);-1!==e&&t.rawMaterialList.splice(e,1)},list:U,formItem:t,visibleModal:n,validateInfos:o,close:s,submit:p}}}),L=k(" 新增物料 ");const P=o({name:"DProduceProcessData",components:{DAdd:_(D,[["render",function(a,e,t,l,r,d){const i=p("a-select"),o=p("a-form-item"),n=p("a-input-number"),s=p("a-col"),m=p("MinusCircleOutlined"),u=p("a-row"),c=p("PlusOutlined"),k=p("a-button"),O=p("a-input"),g=p("a-form"),j=p("a-modal");return f(),I(j,{visible:a.visibleModal,"onUpdate:visible":e[0]||(e[0]=e=>a.visibleModal=e),title:a.isModify?"修改":"新增",width:"800px",cancelText:"取消",okText:"提交",onOk:a.submit,onCancel:a.close},{default:b((()=>[w(g,{"label-col":{span:6},"wrapper-col":{span:14}},{default:b((()=>[(f(!0),v(x,null,y(a.list,(e=>(f(),v(x,null,["targetMaterialId"===e.dataIndex?(f(),I(o,M({key:0,key:e.dataIndex,label:e.title},a.validateInfos[e.dataIndex]),{default:b((()=>[w(i,{value:a.formItem[e.dataIndex],"onUpdate:value":t=>a.formItem[e.dataIndex]=t,placeholder:"请选择","show-search":"","option-filter-prop":"label",options:a.materialArr},null,8,["value","onUpdate:value","options"])])),_:2},1040,["label"])):"targetMaterialNum"===e.dataIndex?(f(),I(o,M({key:1,key:e.dataIndex,label:e.title},a.validateInfos[e.dataIndex]),{default:b((()=>[w(n,{value:a.formItem[e.dataIndex],"onUpdate:value":t=>a.formItem[e.dataIndex]=t,placeholder:`请输入${e.title}`},null,8,["value","onUpdate:value","placeholder"])])),_:2},1040,["label"])):"pass"===e.dataIndex?(f(),I(o,M({key:2,key:e.dataIndex,label:e.title},a.validateInfos[e.dataIndex]),{default:b((()=>[w(n,{value:a.formItem[e.dataIndex],"onUpdate:value":t=>a.formItem[e.dataIndex]=t,placeholder:`请输入${e.title}`,max:100,min:0,formatter:a=>`${a}%`,parser:a=>a.replace("%","")},null,8,["value","onUpdate:value","placeholder","formatter","parser"])])),_:2},1040,["label"])):"rawMaterialList"===e.dataIndex?(f(),v(x,{key:3},[(f(!0),v(x,null,y(a.formItem.rawMaterialList,((t,l)=>(f(),I(o,{key:t+e+l,label:e.title,name:["domains1",l,"value"]},{default:b((()=>[w(u,{align:"middle"},{default:b((()=>[w(s,{span:"8"},{default:b((()=>[w(i,{value:t.rawMaterialId,"onUpdate:value":a=>t.rawMaterialId=a,placeholder:"请选择","show-search":"","option-filter-prop":"label",options:a.materialArr},null,8,["value","onUpdate:value","options"])])),_:2},1024),w(s,{span:"11",offset:"2"},{default:b((()=>[w(n,{value:t.rawMaterialNum,"onUpdate:value":a=>t.rawMaterialNum=a,placeholder:"请输入原材料数量",formatter:e=>`${e}${a.materialObj[t.rawMaterialId]||""}`,parser:e=>e.replace(`${a.materialObj[t.rawMaterialId]||""}`,"")},null,8,["value","onUpdate:value","formatter","parser"])])),_:2},1024),w(s,{span:"1"},{default:b((()=>[a.formItem.rawMaterialList.length>1?(f(),I(m,{key:0,class:"dynamic-delete-button",disabled:1===a.formItem.rawMaterialList.length,onClick:e=>a.removeRawMaterialList(t)},null,8,["disabled","onClick"])):h("",!0)])),_:2},1024)])),_:2},1024)])),_:2},1032,["label","name"])))),128)),w(o,{key:e.dataIndex},{default:b((()=>[w(k,{type:"dashed",style:{width:"60%","margin-left":"190px"},onClick:a.addRawMaterialList},{default:b((()=>[w(c),L])),_:1},8,["onClick"])])),_:2},1024)],64)):e.hideForm?h("",!0):(f(),I(o,M({key:4,key:e.dataIndex,label:e.title},a.validateInfos[e.dataIndex]),{default:b((()=>[w(O,{value:a.formItem[e.dataIndex],"onUpdate:value":t=>a.formItem[e.dataIndex]=t},null,8,["value","onUpdate:value"])])),_:2},1040,["label"]))],64)))),256))])),_:1})])),_:1},8,["visible","title","onOk","onCancel"])}]])},setup(){const a=m({title:"生产工序",loading:!1,data:[],rowKey:"",showModal:!1,formData:null,materialArr:[],materialObj:{},taskMaterial:C}),o="/standard/process",n=[];U.forEach((e=>{const{dataIndex:t,rowKey:l,hideTable:r}=e;l&&(a.rowKey=t),r||n.push(e)})),n.push({title:"操作",dataIndex:"action",align:"center",width:"80px",slots:{customRender:"action"}});const s=()=>{a.loading=!0,O({api:o,method:"get"}).then((e=>{a.loading=!1,a.data=e})).catch(),O({api:"/material",method:"get"}).then((e=>{a.materialArr=[],a.materialObj={},e.forEach((e=>{var t;a.materialArr.push({value:e.materialId,label:e.materialName}),a.materialObj[e.materialId]=(null==(t=null==e?void 0:e.materialUnit)?void 0:t.materialUnitName)||""}))})).catch()},c=()=>{s()},{deleteModal:p}=j();return s(),f=((a,e)=>{for(var t in e||(e={}))r.call(e,t)&&i(a,t,e[t]);if(l)for(var t of l(e))d.call(e,t)&&i(a,t,e[t]);return a})({},u(a)),e(f,t({columns:n,query:s,update:c,add:()=>{a.showModal=!0,a.formData={rawMaterialList:[]}},deleteData:e=>{const t=e[a.rowKey],l={method:"delete",api:o,data:{[a.rowKey]:t}};p(l,(()=>{c()}))},modify:e=>{a.showModal=!0,a.formData=e}}));var f}}),A=k("刷新"),K=k("新增"),q=k("删除");var N=_(P,[["render",function(a,e,t,l,r,d){const i=p("a-button"),o=p("d-table"),n=p("d-card"),s=p("d-add");return f(),v(x,null,[w(n,{title:a.title},{default:b((()=>[w(o,{loading:a.loading,columns:a.columns,"data-source":a.data,rowKey:a.rowKey,isSearch:!0},{header:b((()=>[w(i,{type:"primary",onClick:a.query},{default:b((()=>[A])),_:1},8,["onClick"]),w(i,{type:"primary",onClick:a.add},{default:b((()=>[K])),_:1},8,["onClick"])])),action:b((({record:e})=>[w(i,{type:"primary",size:"small",onClick:t=>a.deleteData(e)},{default:b((()=>[q])),_:2},1032,["onClick"])])),expandedRowRender:b((({record:e})=>[w(o,{columns:a.taskMaterial,"data-source":e.rawMaterialList,rowKey:"rawMaterialId"},null,8,["columns","data-source"])])),_:1},8,["loading","columns","data-source","rowKey"])])),_:1},8,["title"]),w(s,{visible:a.showModal,"onUpdate:visible":e[0]||(e[0]=e=>a.showModal=e),"form-data":a.formData,"is-modify":Boolean(a.formData&&a.formData[a.rowKey]),materialArr:a.materialArr,materialObj:a.materialObj,onUpdate:a.update},null,8,["visible","form-data","is-modify","materialArr","materialObj","onUpdate"])],64)}]]);export{N as default};
