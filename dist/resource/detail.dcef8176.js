var a=Object.defineProperty,e=Object.defineProperties,t=Object.getOwnPropertyDescriptors,l=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,d=Object.prototype.propertyIsEnumerable,o=(e,t,l)=>t in e?a(e,t,{enumerable:!0,configurable:!0,writable:!0,value:l}):e[t]=l;import{d as i,q as s,B as n,f as u,x as m,a2 as c,r as p,o as f,c as I,w as b,k as v,g as h,E as w,J as y,at as k,h as M,u as x,T as g,j as N,t as T,ax as j,I as O}from"./vendor.7b399e54.js";import{p as D}from"./index.cdf0aeb6.js";import{a as U,d as _,m as A}from"./index.57446d29.js";import{_ as C,e as P}from"./index.0cf77487.js";import{D as S}from"./add-data.d9c27c37.js";const q=[{title:"唯一标识",dataIndex:"productiveSubTaskId",rowKey:!0,hideTable:!0,hideForm:!0},{title:"⼯序名称",dataIndex:"productiveSubTaskName",hideForm:!0,required:!0},{title:"⽣产计划",dataIndex:"productiveTaskId",hideForm:!0,hideTable:!0,required:!0},{title:"⽬标物料",dataIndex:"targetMaterialId",hideTable:!0,hideForm:!0},{title:"⽬标物料",dataIndex:"targetMaterialName",hideForm:!0},{title:"标准⼯序",dataIndex:"standardProcessId",required:!0},{title:"物料数量",dataIndex:"targetMaterialNum"},{title:"⼯序状态",dataIndex:"productiveSubTaskStatus",hideForm:!0},{title:"原材料",dataIndex:"rawMaterialList",hideTable:!0,slots:{customRender:"rawMaterialList"}},{title:"计划开始时间",dataIndex:"scheduledStartTime",required:!0,slots:{customRender:"date"}},{title:"计划结束时间",dataIndex:"scheduledEndTime",required:!0,slots:{customRender:"date"}},{title:"描述",dataIndex:"description"}],K=[{title:"物料ID",dataIndex:"rawMaterialId",rowKey:!0},{title:"物料代码",dataIndex:"rawMaterialCode"},{title:"物料名称",dataIndex:"rawMaterialName"},{title:"物料数量",dataIndex:"rawMaterialNum"}],F=i({name:"DAddTaskData",components:{},props:{visible:{required:!0,type:Boolean,default:!1},formData:{type:Object,default:()=>null},isModify:{required:!0,type:Boolean,default:!1},materialArr:Array,materialObj:Object},setup(a,{emit:e}){const t=s({}),l=s({});q.forEach((a=>{const{title:e,dataIndex:r}=a;a.required&&(l[r]=[{required:!0,message:`${e}不能为空！`}]),t[r]=""}));const{useForm:r}=c,{resetFields:d,validate:o,validateInfos:i}=r(t,l),{visibleModal:p,close:f,submit:I}=U(n(a),e,{resetFields:d,validate:o},{formItem:t,api:"/productive/sub/task"}),b=u(null),v=u([]);return m((()=>[t.standardProcessId,t.targetMaterialNum]),(()=>{if(t.standardProcessId){if(!t.targetMaterialNum)return;const{targetMaterialId:a,standardProcessName:e,rawMaterialList:l}=b[t.standardProcessId];t.targetMaterialId=a,t.productiveSubTaskName=e,t.rawMaterialList=l.map((a=>({rawMaterialId:a.rawMaterialId,rawMaterialNum:a.rawMaterialNum*t.targetMaterialNum})))}})),D({api:"/standard/process",method:"get"}).then((a=>{v.value=[],b.value={},a.forEach((a=>{v.value.push({value:a.standardProcessId,label:a.standardProcessName}),b[a.standardProcessId]=a}))})).catch(),{processArr:v,detail:q,formItem:t,visibleModal:p,validateInfos:i,close:f,submit:I}}});const L=i({name:"DProduceTaskDetail",components:{DAdd:C(F,[["render",function(a,e,t,l,r,d){const o=p("a-select"),i=p("a-form-item"),s=p("a-date-picker"),n=p("a-input-number"),u=p("a-col"),m=p("a-row"),c=p("a-input"),x=p("a-form"),g=p("a-modal");return f(),I(g,{visible:a.visibleModal,"onUpdate:visible":e[0]||(e[0]=e=>a.visibleModal=e),title:a.isModify?"修改":"新增",width:"800px",cancelText:"取消",okText:"提交",onOk:a.submit,onCancel:a.close},{default:b((()=>[v(x,{"label-col":{span:6},"wrapper-col":{span:14}},{default:b((()=>[(f(!0),h(y,null,w(a.detail,(e=>(f(),h(y,null,["standardProcessId"===e.dataIndex?(f(),I(i,k({key:0,key:e.dataIndex,label:e.title},a.validateInfos[e.dataIndex]),{default:b((()=>[v(o,{value:a.formItem[e.dataIndex],"onUpdate:value":t=>a.formItem[e.dataIndex]=t,placeholder:"请选择","show-search":"","option-filter-prop":"label",options:a.processArr},null,8,["value","onUpdate:value","options"])])),_:2},1040,["label"])):["scheduledStartTime","scheduledEndTime"].includes(e.dataIndex)?(f(),I(i,k({key:1,key:e.dataIndex,label:e.title},a.validateInfos[e.dataIndex]),{default:b((()=>[v(s,{value:a.formItem[e.dataIndex],"onUpdate:value":t=>a.formItem[e.dataIndex]=t,type:"date",placeholder:"请选择",style:{width:"100%"}},null,8,["value","onUpdate:value"])])),_:2},1040,["label"])):"targetMaterialNum"===e.dataIndex?(f(),I(i,k({key:2,key:e.dataIndex,label:e.title},a.validateInfos[e.dataIndex]),{default:b((()=>[v(n,{value:a.formItem[e.dataIndex],"onUpdate:value":t=>a.formItem[e.dataIndex]=t,placeholder:`请输入${e.title}`},null,8,["value","onUpdate:value","placeholder"])])),_:2},1040,["label"])):"rawMaterialList"===e.dataIndex?(f(!0),h(y,{key:3},w(a.formItem.rawMaterialList,((t,l)=>(f(),I(i,{key:t+e+l,label:e.title,disabled:!0,name:["domains1",l,"value"]},{default:b((()=>[v(m,{align:"middle"},{default:b((()=>[v(u,{span:"8"},{default:b((()=>[v(o,{value:t.rawMaterialId,"onUpdate:value":a=>t.rawMaterialId=a,placeholder:"请选择","show-search":"","option-filter-prop":"label",options:a.materialArr},null,8,["value","onUpdate:value","options"])])),_:2},1024),v(u,{span:"11",offset:"2"},{default:b((()=>[v(n,{value:t.rawMaterialNum,"onUpdate:value":a=>t.rawMaterialNum=a,placeholder:"请输入原材料数量",formatter:e=>`${e}${a.materialObj[t.rawMaterialId]||""}`,parser:e=>e.replace(`${a.materialObj[t.rawMaterialId]||""}`,"")},null,8,["value","onUpdate:value","formatter","parser"])])),_:2},1024)])),_:2},1024)])),_:2},1032,["label","name"])))),128)):e.hideForm?M("",!0):(f(),I(i,k({key:4,key:e.dataIndex,label:e.title},a.validateInfos[e.dataIndex]),{default:b((()=>[v(c,{value:a.formItem[e.dataIndex],"onUpdate:value":t=>a.formItem[e.dataIndex]=t},null,8,["value","onUpdate:value"])])),_:2},1040,["label"]))],64)))),256))])),_:1})])),_:1},8,["visible","title","onOk","onCancel"])}]]),DAddNote:S},setup(){const a=x(),i=s({title:"生产计划工序",loading:!1,data:[],rowKey:"",showModal:!1,formData:null,materialArr:[],materialObj:{},taskMaterial:K,showNoteModal:!1,formNoteData:null}),{productiveTaskId:u}=a.query,m=`/productive/sub/task?productiveTaskId=${u}`,c=[];q.forEach((a=>{const{dataIndex:e,rowKey:t,hideTable:l}=a;t&&(i.rowKey=e),l||c.push(a)})),c.push({title:"操作",dataIndex:"action",align:"center",width:"80px",slots:{customRender:"action"}});const p=()=>{i.loading=!0,D({api:m,method:"get"}).then((a=>{i.loading=!1,i.data=a})).catch(),D({api:"/material",method:"get"}).then((a=>{i.materialArr=[],i.materialObj={},a.forEach((a=>{var e;i.materialArr.push({value:a.materialId,label:a.materialName}),i.materialObj[a.materialId]=(null==(e=null==a?void 0:a.materialUnit)?void 0:e.materialUnitName)||""}))})).catch()},f=()=>{p()},{deleteModal:I}=_();return p(),b=((a,e)=>{for(var t in e||(e={}))r.call(e,t)&&o(a,t,e[t]);if(l)for(var t of l(e))d.call(e,t)&&o(a,t,e[t]);return a})({},n(i)),e(b,t({columns:c,query:p,update:f,add:()=>{i.showModal=!0,i.formData={productiveTaskId:u,rawMaterialList:[]}},note:a=>{console.log(a),i.showNoteModal=!0,i.formNoteData={materialList:a.rawMaterialList,noteType:0}},deleteData:a=>{const e=a[i.rowKey],t={method:"delete",api:m,data:{[i.rowKey]:e}};I(t,(()=>{f()}))},taskStatus:(a,e)=>{const{confirmModal:t}=A();t({title:"修改工序状态提示",content:"此操作将修改工序状态, 是否继续?"},(()=>{const{productiveSubTaskId:t}=a;D({api:`/productive/sub/task/${e}?productiveSubTaskId=${t}`,method:"put",data:{productiveSubTaskId:t}}).then((()=>{g.success("修改工序状态成功"),f()})).catch()}))},getTime:P,modify:a=>{i.showModal=!0,i.formData=a}}));var b}}),E=O("刷新"),$=O("新增"),R=O(" 操作 "),B=["onClick"],J=["onClick"],z=["onClick"],G=["onClick"];var H=C(L,[["render",function(a,e,t,l,r,d){const o=p("a-button"),i=p("DownOutlined"),s=p("a-menu-item"),n=p("a-menu"),u=p("a-dropdown"),m=p("d-table"),c=p("d-card"),I=p("d-add"),w=p("d-add-note");return f(),h(y,null,[v(c,{title:a.title},{default:b((()=>[v(m,{loading:a.loading,columns:a.columns,"data-source":a.data,rowKey:a.rowKey,isSearch:!0},{header:b((()=>[v(o,{type:"primary",onClick:a.query},{default:b((()=>[E])),_:1},8,["onClick"]),v(o,{type:"primary",onClick:a.add},{default:b((()=>[$])),_:1},8,["onClick"])])),date:b((({text:e})=>[N("p",null,T(a.getTime(e)),1)])),action:b((({record:t})=>[v(u,{placement:"bottomCenter"},{overlay:b((()=>[v(n,null,{default:b((()=>[v(s,{key:"start"},{default:b((()=>[N("a",{onClick:e=>a.taskStatus(t,"start")},"启动",8,B)])),_:2},1024),v(s,{key:"finish"},{default:b((()=>[N("a",{onClick:e=>a.taskStatus(t,"finish")},"完成",8,J)])),_:2},1024),v(s,{key:"delete"},{default:b((()=>[N("a",{onClick:e=>a.deleteData(t)},"删除",8,z)])),_:2},1024),v(s,{key:"note"},{default:b((()=>[N("a",{onClick:e=>a.note(t)},"领料出库",8,G)])),_:2},1024)])),_:2},1024)])),default:b((()=>[N("a",{onClick:e[0]||(e[0]=j((()=>{}),["prevent"]))},[R,v(i)])])),_:2},1024)])),expandedRowRender:b((({record:e})=>[v(m,{columns:a.taskMaterial,"data-source":e.rawMaterialList,rowKey:"rawMaterialId"},null,8,["columns","data-source"])])),_:1},8,["loading","columns","data-source","rowKey"])])),_:1},8,["title"]),v(I,{visible:a.showModal,"onUpdate:visible":e[1]||(e[1]=e=>a.showModal=e),"form-data":a.formData,"is-modify":Boolean(a.formData&&a.formData[a.rowKey]),materialArr:a.materialArr,materialObj:a.materialObj,onUpdate:a.update},null,8,["visible","form-data","is-modify","materialArr","materialObj","onUpdate"]),v(w,{visible:a.showNoteModal,"onUpdate:visible":e[2]||(e[2]=e=>a.showNoteModal=e),"form-data":a.formNoteData,"is-modify":Boolean(a.formNoteData&&a.formNoteData[a.rowKey]),materialArr:a.materialArr,materialObj:a.materialObj,onUpdate:a.update},null,8,["visible","form-data","is-modify","materialArr","materialObj","onUpdate"])],64)}]]);export{H as default};
